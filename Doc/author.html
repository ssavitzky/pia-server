<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- Begin Document Specific Declarations -->
<!-- End Document Specific Declarations -->
<html>
<head>
<title>PIA Application Author's Guide</title>
</head>
<body>
<center>
<h1>PIA Application Author's Guide</h1>
</center>

<p> This document provides an overview of agent and application writing in the
    PIA system. In particular it describes:
</p>

<ul>
<li><a href="#Naming">Agent naming</a></li>

<li><a href="#Types">Agent types</a></li>

<li><a href="#Files">Agent files</a></li>

<li><a href="#Code">Agent data structures and code</a></li>

<li><a href="#Tips">Tips on agent creation</a></li>
</ul>

<p>The extended HTML tags needed to create agents are described in
the <a href="Tagsets/tsdoc/pia-xhtml.html">PIA XHTML
Manual</a>.</p>

<p>Source code for sample agents is in the <a href='../PIA/Agents'>
Agents</a> directory at the top-level of the PIA's installation
tree. Feel free to use these files as a source of ideas and
examples, and as a basis for creating new agents.</p>

<h2><a name="Naming"></a>Agent Naming and Directories</h2>

<p> Every agent has a <em>name</em> and a <em>path</em>.  The file portion of
    the agent's URL consists of the path and name concatenated together; the
    path always begins and ends with the slash (<code>/</code>) character (and
    may consist of only one slash, and nothing else).  The combination of path
    and name is called the agent's <em>pathname</em>. 
</p>

<p> An agent's pathname can be combined with the tilde (<code>~</code>)
    character in various ways to address its four directories:  root, home,
    user, and data.  (In most cases the root and home directories are the
    same.)
</p>

<p> The base directories PIA_HOME and PIA_ROOT can be set on the
    <code>pia</code> command line or in the corresponding environment
    variables.  They are normally the root of the PIA directory tree (called
    PIA and located wherever the PIA is installed in your system) and (on
    Unix) a directory called <code>.pia</code> in your home directory.
</p>

<p> In the table that follows, the leading and trailing slashes of the path
    are shown explicitly for clarity. 
</p>

<table width="90%" align=center border=1>
  <tr> <th align=left> URL </th>
	<th align=left> Default Directory </th>
	<th align=left> Entity </th>
       <th align=left> Description </th>
  </tr>
  <tr> <td> <code>/<em>path</em>/<em>name</em></code>  			</td>
       <td> <code>PIA_HOME/Agents/<em>path</em>/<em>name</em></code> 	</td> 
       <td> &nbsp; 		</td>
       <td> root directory 	</td>
  </tr>
  <tr> <td> <code>/<em>path</em>/<em>name</em>~</code> 			</td>
       <td> <code>PIA_HOME/Agents/<em>path</em>/<em>name</em></code> 	</td> 
       <td> AGENT:home-dir 	</td>
       <td> home directory 	</td>
  </tr>
  <tr> <td> <code>/<em>path</em>/<em>name</em>/~</code> 		</td>
       <td> <code>PIA_ROOT/<em>path</em>/<em>name</em></code> 		</td>
       <td> AGENT:data-dir  	</td>
       <td> data directory 	</td>
  </tr>
  <tr> <td> <code>/~<em>name</em></code> 		</td>
       <td> <code>PIA_ROOT/<em>path</em>/<em>name</em></code> 		</td>
       <td> AGENT:data-dir  	</td>
       <td> data directory (deprecated)	</td>
  </tr>
  <tr> <td> <code>/~/Agents/<em>path</em>/<em>name</em></code> 		</td>
       <td> <code>PIA_ROOT/Agents/<em>path</em>/<em>name</em></code> 	</td>
       <td> AGENT:user-dir 	</td>
       <td> data directory 	</td>
  </tr>
  <tr> <td> <code>/~/<em>path</em>/<em>name</em>~</code> 		</td>
       <td> <code>PIA_ROOT/<em>path</em>/<em>name</em></code> 		</td>
       <td> AGENT:data-dir 	</td>
       <td> data directory 	</td>
  </tr>
</table>

<p> The paths involving <code>/~/</code> are simply a consequence of the fact
    that the ROOT agent's root directory is its data directory, and is mapped
    to the PIA data directory.  There is normally no way to address the user
    directory directly; files in it simply override (replace) corresponding
    files in the home directory.
</p>

<p> The path <code>/~<em>name</em></code> is an older construct; it's
    ambiguous if the path starts with the name of some other agent.  It is
    still useful, however, because it follows the standard convention for
    ``user directories'' on Unix systems and the Web.  You could, for example,
    define an agent with your login name as its name; its data directory would
    then look like your web home page.
</p>

<p> By convention, agent names intended to be seen at the top level of an
    agent listing are capitalized, but this is not required. Name lookup is
    case-sensitive, and there may be good reasons to prefer uppercase or
    lowercase names in some cases. For example, DOFS is uppercase because it
    is an acronym. Most agents with DOFS as their type have names that match
    their corresponding root directory; for example, <code>/PIA</code>.  For
    another example, <code>fileTools</code> and <code>remoteTools</code> are
    sub-agents of <code>Proxie/Toolbar</code>, and so have lowercase names.
</p>

<p> For historical reasons, it is currently possible to address an agent by
    its name (for example, <code>/<em>name</em></code> for the home directory)
    even if it has a non-null path.  This will eventually disappear.
</p>


<h2><a name="Types">Agent Types</a></h2>

<p>Every agent also has a <em>type</em>, which can be 
used to create a family of agents with similar behavior but
different options. The <a href="/DOFS">DOFS</a> agents form such a
family. So do the <a href="/Toolbar">&Toolbar;</a> agents <a href= 
'/remoteTools/'>remoteTools</a> and <a href='/fileTools/'>
fileTools</a>. In most case, the type classification name
represents not only the family name but names an agent of which the
others are "sub-agents."</p>

<p> To be specific, the type is the complete pathname of an agent from which
    files are ``inherited''.  An agent will search for files first in its user
    directory, then its home directory, and then in the directories of its
    type agent.  An agent without a type will finally look in the
    <code>Agent</code> subdirectories of PIA_ROOT and PIA_HOME.
</p>

<p> Agents that are not "sub-agents" of some type have their type the same as
    their name.  An XHTML script can verify this with the following test:
</p>

<blockquote><code>&lt;test exact
match="&amp;AGENT:name;&gt;"&amp;AGENT:type;&lt;/test&gt;</code></blockquote>


<h2><a name="Files"></a>Agent Files</h2>

<p>This section describes the files that make up an agent.</p>

<h3>File Names</h3>

<p> Unlike most web servers, the PIA does not require filename extensions
    (also called ``suffixes'' or, in Windows, ``filetypes'').  This makes it
    possible to refer to a document without revealing to the user whether it
    is an ordinary HTML file or is created on-the-fly from an active document.
    It also makes URL's shorter (and hence easier to remember). 
</p>

<p> Documents in an agent's home and user directories are looked up with
    a different (larger) set of suffixes from files in the data directory;
    this reflects the fact that active documents are not permitted in the data
    directory, for security reasons.
</p>

<p> A file's extension, as usual, determines its MIME type.  For active
    documents, it also determines the tagset used to process the file:
</p>

<table>
  <tr><th> &nbsp; </th>
      <th> tagset </th>
      <th> meaning </th>
  </tr>
  <tr><th> .xh </th> <td> xhtml </td>
      <td> Extended HTML </td>
  </tr>
  <tr><th> .xx </th> <td> xxml </td>
      <td> Extended XML </td>
  </tr>
  <tr><th> .html </th> <td> html </td>
      <td> Ordinary HTML </td>
  </tr>
  <tr><th> .htm </th> <td> html </td>
      <td> Ordinary HTML </td>
  </tr>
  <tr><th> .xml </th> <td> <em>none</em> </td>
      <td> Ordinary XML </td>
  </tr>

  <tr><th colspan=2>&nbsp;</th><th>&nbsp;</th></tr>

  <tr><th colspan=2>&nbsp;</th>
      <th> (used internally) </th>
  </tr>

  <tr><th> .inc </th> <td> xhtml </td>
      <td> ``include'' files </td>
  </tr>
  <tr><th> .ts </th> <td> tagset </td>
      <td> tagset files </td>
  </tr>
  <tr><th> .xml </th> <td> depends on usage. </td>
      <td> Ordinary XML </td>
  </tr>
</table>

<p> File names passed to the PIA in URL's are always handled by the
    appropriate agent.  Relative filenames always have the current base
    (pathname) prepended by the browser.
</p>

<p> Inside the PIA things are somewhat more complex: there are two additional
    contexts to consider.  These are the form fields used during agent
    initialization, and the attributes that designate system resources:
    ``<code>src</code>'' in the &lt;include&gt;, &lt;connect&gt;, and
    &lt;status&gt; elements, and the ``system names'' of entities.  The
    following conventions are used for agent initialization:
</p>

<!-- === the following table is totally wrong now! === -->
<table>
  <tr><td> <code>~/</code></td>
      <td> The user's home directory </td>
  <tr><td> <code>./</code></td>
      <td> (or any relative path) the PIA agent directory</td>
  <tr><td> <code>../</code></td>
      <td> the PIA's home directory <code>PIA_HOME</code></td>
  <tr><td> <code>/~/</code></td>
      <td> The PIA's real root directory <code>PIA_ROOT</code></td>
  <tr><td> <code>/</code></td>
      <td> An absolute path in URL format.</td>
  <tr><td> <code>file:</code></td>
      <td> An absolute path in system format.</td>
</table>

<p> When the <code>file:</code> prefix is not present, paths are in ``URL
    format'':  slash characters are converted, if necessary, to the
    operating system's file separator.
</p>


<p> In elements that may access URL's as well as files, for example an
    additional prefix of <code>pia:</code> is used to distinguish between
    normal file lookup, as above, and agent-based lookup, which is the
    default.  In agent-based lookup, extensions and paths are handled
    according to the agent's naming rules, above.  In other words, anything
    that looks like the file part of a URL is treated as if it was:
</p>

<table>
  <tr><td> <code>/<em>path</em>/<em>name</em></code></td>
      <td> looked up relative to the given agent </td>
  <tr><td> <code>&nbsp;</code></td>
      <td> relative paths are looked up by the <em>current</em> agent </td>
  <tr><td> <code>pia:~/</code></td>
      <td> The user's home directory </td>
  <tr><td> <code>pia:./</code></td>
      <td> (or any relative path) the PIA agent directory</td>
  <tr><td> <code>pia:../</code></td>
      <td> the PIA home directory <code>PIA_HOME</code></td>
  <tr><td> <code>pia:/~/</code></td>
      <td> The PIA user directory <code>PIA_ROOT</code></td>
  <tr><td> <code>pia:/</code></td>
      <td> An absolute path in URL format.</td>
  <tr><td> <code>file:</code></td>
      <td> An absolute path in system format.</td>
</table>

<h3>Standard Files</h3>

<p>A PIA Agent consists of little more than a collection of
extended HTML (XHTML) files organized in a directory.
Agents require a set of standard files.
Those files, listed below, are "inherited" from the root directory
(PIA_HOME/Agents) if they are not found in the agent's home directory.</p>

<ul>
<li> <code>home.xh</code><br>
     
     The agent's "home page." This is the page that appears when the agent is
     selected from the Agency's list of running agents. It is therefore
     usually the first page seen by a user, and should include links to at
     least the most useful of the agent's other pages. It is returned from a
     request for <code>/AgentName</code>.</li>

<li> <code>index.xh</code> and <code>about.inc</code><br>
     
     The page returned from a request for <code>/AgentName/</code>. Note
     the trailing slash that distinguishes this page from the home page.
     It gives a standardized listing of the agent's default pages, sub-agents,
     and so on.  Typically, it needs no customization.  The default includes
     the agent-specific file <code>about.inc</code> if it is present.</li>

<li> <code>help.xh</code> and <code>help.inc</code><br>
     
     This page is meant to provide general and context-specific help for the
     agent.  The default page is customized by including the agent-specific
     file <code>help.inc</code>, if present. </li>

<li> <code>options.xh</code><br>
     Lists the agent's options.  This page seldom, if ever, requires
     customization.  The <code>options</code> page also displays the agent's
     data in XML format, suitable for use in an <code>AGENT.xml</code> file.
     </li>

<li> <code>AGENT.xml</code><br>
     This XML file is <em>loaded</em> (read by the PIA) to initialize and
     install the agent.  It contains all the information necessary for
     constructing the agent.  A version of it can be written into the agent's
     user directory to preserve user customizations. </li>

<li> <code>initialize.xh</code><br>
     This XHTML file is invoked automatically when the agent is created. It
     defines default values for any options and sets the "match criteria" for
     transactions that the agent acts on. This file does <em>not</em> have a
     default, but it can be omitted if it is not needed.</li>
</ul>


<h2><a name="Code">Agent Data Structures and Code</a></h2>

<p>Every installed agent has an associated software object which
contains its options (stored as entities in the <code>AGENT</code>
namespace) and the criteria that match features of the transactions
in which the agent has registered interest.</p>

<p> This object is normally an instance of the class
    <code>GenericAgent</code>.  If a subclass of this class is defined in the
    package <code>org.risource.pia.agent</code>, and its name matches the
    agent's type (with the first character capitalized, the rest in lowercase,
    and all period (<code>.</code>) and hyphen (<code>-</code>) characters
    converted to underscore (<code>_</code>) characters), it is loaded
    automatically when the agent is installed.</p>

<p>It is sometimes necessary to use a different programming language from Java
for part of an agent. (For example, PERL is good for text manipulation).  The
best technique is to put the external code into a CGI script (with a
<code>.cgi</code> extension).  PERL is a popular choice for a scripting
language because it is nearly as ubiquitous as Java. Be warned, though, that
not all of its libraries or extensions are available on all systems.</p>

<p> An alternative to CGI scripts is the Java native interface, or Java code
    that uses the <code>exec</code> method of the
    <code>java.lang.Runtime</code> class to invoke an operating-system
    command.  These techniques are not likely to be portable.  At one point,
    there was an element &lt;os-command&gt; that did this; it was removed
    partly for security reasons, and partly to encourage portability.  CGI
    scripts in PERL are more likely to be portable.
</p>

<h2><a name="Tips"></a>Tips on Agent Creation</h2>

<p>PIA agents and active documents  are so new that few conventions
have become established for their use and there is considerable
room for experimentation. A few rules of thumb have become
clear:</p>

<h3>Uniform Look and Feel</h3>

<p>Use tagsets to give a family of related agents a similar appearance. The
PIA uses <code>&lt;header&gt;</code>, <code>&lt;subhead&gt;</code>, and
<code>&lt;footer&gt;</code> in this way; almost every agent XHTML page
includes the code which expands into a standardized heading.</p>

<p> Use ``include'' files and agent-specific entities to customze inherited
    pages.  The standard <code>include</code> files currently available
    are:
</p>

<ul>
  <li><code>about.inc</code> <br>
       Information "about" an agent. This information is similar to what
       you might see on the "about" menu item on a Windows or Macintosh
       application. This is displayed by the default <code>home.xh</code>
       file just underneath the quick reference generated by the
       <code>&lt;subhead&gt;</code> element.</li>

  <li><code>insert.inc</code> <br>
       An image or set of links "inserted" in the normally-empty space to
       the left of the quick reference. On an application, this is often a
       link to the agent that serves as a control panel.</li>
</ul>

<p> The other files that are frequently modified are: </p>

<ul>
  <li> <code>home.xh</code><br>
       Almost every agent will benefit from a customized home page.
       Agent-specific information is often put into the home page's 
       <code>&lt;subhead&gt;</code> element, for example. 

  <li> <code><em>Agent</em>-xhtml.ts</code><br>
       An agent-specific tagset file.  This allows modified versions of tags
       such as <code>&lt;header&gt;</code> and <code>&lt;subhead&gt;</code> to
       be defined (redefining <code>&lt;subhead&gt;</code> is not uncommon),
       as well as tags that are unique to the agent. </li> 
</ul>

<h3>Quick Reference Up Front</h3>

<p>An agent's home page is the easiest to access. Additionally,
many users have browsers with small screens. Therefore it makes
sense to put the most-commonly-used functions, and links to the
most-commonly-used pages, as close to the top of an agent's home
page as possible.</p>

<p>There are two common formats for this. The first uses a single
column of links near the right-hand side of the screen. The column
just to the left contains a small number of labels.  This format is
automatically generated by the  <code>&lt;subhead&gt;</code> tag; its contents
can contain additional two-column table rows. </p>

<p>The second format is sometimes used on the home pages of applications,
which typically have many functions. It consists of <em>three</em>
columns of icons, or of mixed icons and text.</p>

<h3>No Nasty Surprises</h3>

<p>It is perfectly possible to put a query string into a link, and
so have an ordinary-looking link or icon that is equivalent to
submitting a form. In a PIA this can have drastic effects -- some of our
prototype appliances included a form for shutting down the system!</p>

<p>Many users experiment, clicking links at random. You may also want to use a
robot to build an index of your PIA, or to identify broken links.  It's a good
idea to make any irreversible actions the result of submitting a form, rather
than just following a link.  This also gives you a chance to ask the user for
confirmation.</p>

<blockquote>Eventually it will be possible to use standard HTTP
authentication to keep unauthorized users away from agents or forms
you do not want them to use.</blockquote>

<h3>Active Documentation</h3>

<p>XHTML forms make it easy to mix controls or forms with their
documentation. Thus, it is possible not only to <em>describe</em> a
function such as a link to a useful page or a form, but to provide
the thing itself and invite the reader to try it out on the
spot.</p>

<p>Wherever possible, an agent should be self-documenting,
including links to whatever documents a user may need. This
includes tips on customization as well as advice on how to set the
options. A <code>HEADER.html</code> or <code>index.html</code> file
in the agent's home directory may be useful, since it can provide
documentation that the user sees while browsing the agent's source
code directory <em>before</em> installation. It should include an
installation form, especially if an agent has many options.</p>

<h3>Readable Source</h3>

<p>It goes without saying that the output of a XHTML file--the
user's view--should be easily read, understood, and used. But so
should the input--the author's view.</p>

<p>Appropriate indentation makes for easier-to-read code. Indent
the content of elements such as lists and control structures.
Comment the file as appropriate.</p>

<p>Keep a to-do list. Document your design decisions, including
things you tried that turned out to be mistakes.</p>

<p>Use source control (the PIA group uses CVS, which is free,
well-supported, and well-suited for projects with multiple
developers).</p>

<p>Remember, an agent's XHTML files are read not only by their
author, but by any users who want to customize or extend them. If
the agent is complicated, consider writing an ``implementation
details'' document.</p>

<p> The conventional names for documentation files in the PIA are: </p>

<ul>
  <li> <code>to-do.html</code><br>
       ``to-do'' list, usually with the most recent entries at the top.

  <li> <code>done.html</code><br>
       completed items moved from the ``to-do'' list.

  <li> <code>about.html</code><br>
       an ``implementation details'' document, often including design
       decisions and their motivations.
</ul>

<h4><a name="Directory">Directory Structure</a></h4>

<p>Your Information Agency makes use of two directories:</p>

<ul>
  <li> <var>PIA_HOME</var> contains the code, documentation, agents and
       other files released by the PIA group.</li>

  <li> <var>PIA_ROOT</var> (typically <tt>~/.pia</tt> on Unix) stores agent
       data and customized active documents.</li>
</ul>

<p>By default, agents read and write their data files into <var>
PIA_ROOT/AGENT_NAME</var> (where <var>AGENT_NAME</var> is the name
of the agent. For example, the <var>History</var> agent keeps lists
of visited URLs in <tt>~/.pia/History/</tt>)</p>

<p>In seeking their documents, agents look first in <code><var>
PIA_ROOT/Agents/AGENT_NAME</var></code>, where <var>
AGENT_NAME</var> is the name of the agent in question. If that
search fails, the agent then checks <var><code>
PIA_HOME/Agents/AGENT_NAME</code></var>. Thus the <var>History</var>
agent searches for its files in <kbd>~/.pia/Agents/History</kbd>
and then in <kbd>/usr/local/bin/pia/Agents/History</kbd>.</p>

<p>This makes it easy to customize your agents by simply putting
new documents in <code><var>
PIA_ROOT/Agents/AGENT_NAME/FILENAME.xh</var></code>. For example, a
customized form, <tt>foo.xh</tt> for the <var>History</var> agent
would go in <tt>~/.pia/Agents/History/foo.xh</tt>.)</p>

<h4><a name="Customizing">Customizing an Existing Agent</a></h4>

<p>This section shows how to add a new function to the <var>
History</var> agent. The new feature allows you to see a display of
all web pages visited on the current day.</p>

<p>In the example that follows, assume that <var>PIA_ROOT</var> has
the value <code>~/.pia</code>.</p>

<ol>
<li>Create a file, <tt>~/.pia/Agents/History/today.xh</tt>.</li>

<li>Add the following content:
<br>
<tt>&lt;html&gt;&lt;body&gt;</tt>
<br>
<tt>&lt;h2&gt; Web pages visited Today&lt;/h2&gt;</tt>
<br>
<tt>&lt;include src="~/&amp;year;/&amp;month;/&amp;day;.html" /&gt;</tt>
<br>
<tt>&lt;/body&gt;&lt;/html&gt;</tt></li>

<li>Save the file <code>today.xh</code>.</li>

<li>Use your browser to view the URL <code><a href= 
"/History/today.xh">/History/today.xh</a></code> If you have been
using your agency as a proxy to view external documents, you should
get a listing of all places you visited today.</li>
</ol>

<h5>What Is Going On?</h5>

<p>To understand the workings of this document, it is necessary to
understand both the <var>History</var> agent and the specifics of
this particular active document.</p>

<p>The <var>History</var> agent stores information on URLs visited
in files organized by date. For example, the file <tt>
~/.pia/History/1997/07/11.html</tt> stores all the URLs visited on
July 11, 1997. The document <var>today.xh</var> exploits this
fact.</p>

<p>The document shown above contains the standard HTML tags <code>
&lt;html&gt;</code>, <code>&lt;body&gt;</code>, <code>
&lt;h2&gt;</code> and one non-standard tag <code>
&lt;include&gt;</code>. The power of the code comes from this
special tag.</p>

<p>The code also makes use of three entities, <var>
&amp;year;</var>, <var>&amp;month;</var> and <var>&amp;day;</var>.
By assigning the value of the <var>file</var> attribute to these
entities, rather than a hard-coded date, the document always refers to
the current day's date.</p>

<p>Putting it all together, the tag <tt>&lt;include
src="~/&amp;year;/&amp;month;/&amp;day;.html"&gt;</tt> tells the
<var>History</var> agent to read the specified file (starting with the agent's
data directory, as indicated by the <tt>~/</tt>) and insert the
contents at this location. The entities are resolved and if there
is a file for the current day it is displayed. If not, the <code>
&lt;read&gt;</code> tag results in no new text being inserted.</p>

<p>The <a href="Tagsets/basic.html">Basic Tagset Manual</a> provides
further details on each interform tag and entity.</p>

<h3><a name="Creating"></a>Creating a New Agent</h3>

<p>This section describes how to build an agent from scratch. It
describes how to create an agent named <var>HelloWorld</var>.</p>

<ol>
<li>Begin by creating a directory for the agent's interforms.
<br>
Create the directory, <tt>~/.pia/Agents/HelloWorld</tt>.</li>

<li>Create a home page for your agent, <tt>
~/.pia/Agents/HelloWorld/home.xh</tt> with the following content:

<pre>
&lt;!doctype html public "-//IETF//DTD HTML//EN//2.0"&gt;
&lt;HTML&gt; &lt;html&gt; &lt;body&gt;
<br>
&lt;header&gt; Hello World&lt;/header&gt;
<br>
&lt;h2&gt;
I am the  agent &lt;/h2&gt;
<br>
&lt;if&gt;&lt;get name="FORM:data" /&gt;
<br>
&lt;then&gt;You
entered the greeting:
<br>
  &lt;p&gt;&lt;font size=+5 color="FF0000"&gt;
<br>
 
  &lt;get name="FORM:data" /&gt; &lt;/font&gt; &lt;/p&gt;
<br>
&lt;/then&gt;
<br>
&lt;else&gt;

<br>
  &lt;form action="" method="post"&gt;
<br>
  My mission is to
display a greeting.
<br>
  "Hello World!" is customary, but I am very
flexible.
<br>
  My owner, , may decide. &lt;p&gt; 
   &lt;input type="submit" value="Enter"&gt;
<br>
   A Greeting: &lt;input
name="data"&gt;  &lt;p&gt; &lt;/form&gt;
<br>
&lt;/else&gt;
<br>
&lt;/if&gt;
<br>
&lt;footer
/&gt;&lt;/body&gt;&lt;/html&gt;  
</pre>
</li>

<li>Install your agent using the <a href="/Admin/create-agent.xh">
/<code>Admin/create-agent.xh</code></a> form.</li>

<li>Go to that page, enter <tt>HelloWorld</tt> as the name of your
agent and click on the ``<strong>Create</strong>'' button.</li>
</ol>

<p>You should now the able to see and interact with your <var>HelloWorld</var>
agent.</p> 

<h5>What's Going On?</h5>

<p>The <var>HelloWorld</var> agent uses many standard HTML tags.
These include <code>&lt;html&gt;</code>, <code>&lt;h2&gt;</code>,
<code>&lt;if&gt;</code>). The interform extensions employed are
explained below. Additional information can be found in the <a
href="entities.html">Entities Manual</a>.</p>

<p><var>HelloWorld</var> uses three entities.</p>

<table border="1" frame="border">
<tbody>
<tr align="left">
<th>Entity</th>
<th align="left">Explanation</th>
</tr>

<tr>
<td align="left"><code>&amp;agentName;</code></td>
<td align="left">Specifies current agent's name</td>
</tr>

<tr>
<td align="left"><code>&amp;user.name;</code></td>
<td align="left">Specifies user ID this agency is running
under</td>
</tr>

<tr>
<td><code>&amp;urlPath;</code></td>
<td>Specifies that this form should be submitted to the same URL as
the current document</td>
</tr>
</tbody>
</table>

<p><var>HelloWorld</var> uses a number of custom tags.</p>

<table border="1" frame="border">
<tbody>
<tr align="left">
<th>Interform</th>
<th>Example</th>
<th align="left">Explanation</th>
</tr>

<tr>
<td><code>&lt;header&gt;</code></td>
<td align="left"><code>&lt;header&gt;Hello
World&lt;/header&gt;</code></td>
<td align="left">Puts a standard agent header at the top of the
page. This includes the PIA logo, that lets you navigate back to
the Agency home page.</td>
</tr>

<tr>
<td><code>&lt;get&gt;</code></td>
<td align="left"><code>&lt;get name="FORM:data" /&gt;</code></td>
<td align="left">Retrieves the value, if any, of the <tt>data</tt>
field of the form (query string or POST) submitted as part of the request for
this document.</td>
</tr>

<tr>
<td><code>&lt;input&gt;</code></td>
<td><code>&lt;input type="submit" value="Enter"&gt;</code></td>
<td>Specifies the nature of the input the value.</td>
</tr>

<tr>
<td><code>&lt;footer&gt;</code></td>
<td align="left"><code>&lt;footer /&gt;</code></td>
<td align="left">Provides the navigation bar at the bottom of the
screen, along with a copyright notice.</td>
</tr>
</tbody>
</table>

<p>The <var>HelloWorld</var> interform checks to see if the user
has submitted a form. If so, the form data is processed and the
results displayed. If no form has been submitted, the form is
presented for the user to fill out.</p>

<h3><a name="Tips"></a>Tips on Agent Creation</h3>

<p>The following section contains tips on creating agents.
Additional ideas and inspiration might come from a close look at
the interforms of agents that ship with the PIA.</p>

<h4><a name="installing">Installing Agents</a></h4>

<p>In order for the PIA Agency to know about a particular agent and
direct requests to that agent appropriately, that agent must be
installed.  As agents are represented by persistent software
objects, agent installation creates the object that corresponds to
the agent in question.</p>

<p>There are actually two ways to install an agent:  ``<em>loading</em>'' an
XML definition file, and ``<em>creating</em>'' the agent by submitting an HTML
form that specifies its attributes.  Loading is faster, but creating an agent
is an easy way to install a <em>new</em> agent to experiment with or to
extend. </p>

<p>On start-up, the Information Agency looks in the directory
<var>PIA_ROOT</var> and then <var>PIA_HOME</var> for the
<code>/Admin/agent-files.xml</code>, which specifies the XML files that need
to be loaded.  It also looks in <var>PIA_ROOT</var> for
<code>/Admin/START-UP.html</code>, which contains HTML forms to submit in
order to <em>create</em> agents.</p>

<p>When an agent is created, the PIA loads its <tt>initialize.xh</tt>
file, if one exists.  Consider creating such a file for your agent in
<code>initialize.xh</code>. This file typically contains default values for
variables are used by your agent, and may perform additional actions as well.
When an agent is <em>loaded</em>, the PIA runs the ``hook'' contained in its
<code>&amp;initialize;</code> attribute. </p>

<h4>Entities</h4>

<p>Entity variables can be several levels deep. For example, <tt>
&amp;AGENT:employees;</tt> might return the first item in a list of
employees associated with this agent.  Entities in the <code>AGENT:</code>
namespace are shared by all of that agent's documents, and can even be
accessed from <em>other</em> agents.  (The History agent does this with its
toolbar segment, for example.)</p>

<h4>Inheritance</h4>

<p>Standard forms such as <code>options.xh</code>, can be inherited
from the Agents directory. The PIA Agent looks in the <var>
Agents</var> directory if this form is not found in that agent's
subdirectory, <code>/Agents/<var>AGENT_NAME</var></code>.</p>

<h3>Processing Documents Not Specifically Requested</h3>

<p>Agents can process documents moving through the agency even if
they are not specifically directed to that agent. For example, the
History and remoteTools agents process all proxied documents. Each agent
registers a set of <dfn>criteria</dfn> for the documents it is interested in.
Whenever the agency sees a document that matches an agent's
registered criteria, (requests for documents are considered
documents in their own right), that agent is given a chance to
process the document before sending it on to its destination.</p>

<h3><a name="Debugging"></a>Debugging Tag-Based Agents</h3>

<p>As with any code, agent code may not always work correctly the
first time. Here are some techniques for understanding what is
happening within your agent.</p>

<ul>
<li>Use the <tt>&amp;urlQuery</tt>; entity to check that the <em>expected</em>
name/value pairs are being posted from one page to another.  For example if
<code>&urlQuery;</code> is added to the top of the <code>home.xh</code>
page for the HelloWorld agent, you should see something like following when 
you hit the Enter button:
<code>
data=Hello+World</code>.
</li>

<li>Look at the HTML source that is generated, using <var>
View/Document Source</var> in the browser menu. This gives a good
indication of where the code broke down.  Some elements, such as
&lt;include&gt;, insert comments into the output document when an error
occurs. </li>

<li>Put in print statements and expand variables inside tagset
elements to check whether they have been set correctly.  Keep in mind
that only the last value is returned from an element.</li>

<li>Use the <a href="/Demo/demo_debug.xh">debug handler</a> to print the
parse tree.  This shows how the document parser interprets the document,
or document fragment, and sees the relationships between the various nodes.
</li>

<li> Run the pia with the <code>-d</code> (debug) option.  This will produce
     voluminous output about what the pia thinks it's doing.  Adding the
     <code>-v</code> (verbose) flag will produce even more output, tracing the
     progress of the document processing system. </li>
     
</ul>

<hr><b>Copyright &copy; 1999 Ricoh Silicon Valley</b>
<br>
</body>
</html>

